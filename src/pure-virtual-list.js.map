{"version":3,"sources":["../dist/pure-virtual-list.js"],"names":[],"mappings":"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","file":"pure-virtual-list.js","sourcesContent":["/**\n * Created by allin_000 on 04.09.2016.\n */\n\nvar pureVirtualList = (function () {\n\n    var version = '1.0.0';\n\n    const tmpl = addrs => `\n        <div class=\"list-group\">\n            ${addrs.map(addr =>\n                (addr.name.length>1)\n                ?`<a href=\"#action-${addr.guid}-${addr.email}-${addr.company}\" class=\"list-group-item list-group-item-action\">${addr.name}</a>`\n                :`<div class=\"list-group-item \">${addr.name}</div>`\n            ).join('')}\n        </div>\n    `;\n\n\n    //TODO: вынести виртуал лист в отдельный класс, за джойнить в виде модуля к текущему.\n\n    function VirtualList(config) {\n        const width = (config && `${config.w}px`) || '100%';\n        const height = (config && `${config.h}px`) || '100%';\n        const itemHeight = this.itemHeight = config.itemHeight;\n\n        this.items = config.items;\n        this.generatorFn = config.generatorFn;\n        this.totalRows = config.totalRows || (config.items && config.items.length);\n\n        const scroller = VirtualList.createScroller(itemHeight * this.totalRows);\n        this.container = VirtualList.createContainer(width, height);\n        this.container.appendChild(scroller);\n\n        const screenItemsLen = Math.ceil(config.h / itemHeight);\n        // Cache 4 times the number of items that fit in the container viewport\n        this.cachedItemsLen = screenItemsLen * 3;\n        this._renderChunk(this.container, 0);\n\n        const self = this;\n        let lastRepaintY;\n        const maxBuffer = screenItemsLen * itemHeight;\n        let lastScrolled = 0;\n\n        this.rmNodeInterval = setInterval(() => {\n            if (Date.now() - lastScrolled > 100) {\n                const badNodes = document.querySelectorAll('[data-rm=\"1\"]');\n                for (let i = 0, l = badNodes.length; i < l; i++) {\n                    self.container.removeChild(badNodes[i]);\n                }\n            }\n        }, 300);\n\n        function onScroll(e) {\n            const scrollTop = e.target.scrollTop; // Triggers reflow\n            if (!lastRepaintY || Math.abs(scrollTop - lastRepaintY) > maxBuffer) {\n                const first = parseInt(scrollTop / itemHeight) - screenItemsLen;\n                self._renderChunk(self.container, first < 0 ? 0 : first);\n                lastRepaintY = scrollTop;\n            }\n\n            lastScrolled = Date.now();\n            e.preventDefault && e.preventDefault();\n        }\n\n        this.container.addEventListener('scroll', onScroll);\n    }\n\n    function createRow(i) {\n        let item;\n        if (this.generatorFn)\n            item = this.generatorFn(i);\n        else if (this.items) {\n            if (typeof this.items[i] === 'string') {\n                const itemText = document.createTextNode(this.items[i]);\n                item = document.createElement('div');\n                item.style.height = `${this.itemHeight}px`;\n                item.appendChild(itemText);\n            } else {\n                item = this.items[i];\n            }\n        }\n\n        item.classList.add('vrow');\n        item.style.position = 'absolute';\n        item.style.top = `${i * this.itemHeight}px`;\n        return item;\n    }\n\n    function _renderChunk(node, from) {\n        let finalItem = from + this.cachedItemsLen;\n        if (finalItem > this.totalRows) finalItem = this.totalRows;\n\n        // Append all the new rows in a document fragment that we will later append to\n        // the parent node\n        const fragment = document.createDocumentFragment();\n        for (let i = from; i < finalItem; i++) {\n            fragment.appendChild(this.createRow(i));\n        }\n\n        // Hide and mark obsolete nodes for deletion.\n        for (let j = 1, l = node.childNodes.length; j < l; j++) {\n            node.childNodes[j].style.display = 'none';\n            node.childNodes[j].setAttribute('data-rm', '1');\n        }\n        node.appendChild(fragment);\n    }\n\n    function createContainer(w, h) {\n        var c = document.createElement('div');\n        return c;\n    }\n\n    function createScroller(h) {\n        var scroller = document.createElement('div');\n        return scroller;\n    }\n\n\n    //TODO вынести xhr запрос в отдельный класс\n    function requestOnServer(obj){\n        return new Promise(\n            function (resolve, reject) {\n\n                if (!obj) reject(new Error('Haven\\'t setting'));\n\n                const request = new XMLHttpRequest();\n\n                request.onload = function () {\n                    if (obj.statusAcceptence.indexOf(this.status) == 0) {\n                        resolve({\n                            response: this.response,\n                            headers: this.getAllResponseHeaders()\n                        });\n                    } else {\n                        reject(new Error(this.statusText));\n                    }\n                };\n\n                request.onerror = function () {\n                    reject(new Error('XMLHttpRequest Error: '+this.statusText));\n                };\n\n                request.ontimeout = function(){\n                    reject(new Error('XMLHttpRequest Error: timeout'));\n                };\n\n                request.onloadstart = function(){\n                    if (obj.onloadstart) obj.onloadstart();\n                };\n\n                request.onloadend = function(){\n                    if (obj.onloadend) obj.onloadend();\n                };\n\n                request.onprogress = function(){\n                    if (obj.onprogress) obj.onprogress();\n                };\n\n                //XHR settings\n                if (obj.timeout){request.timeout = obj.timeout;}\n                if (!obj.method){obj.method = 'GET'}\n                request.open(obj.method, obj.url, true);\n\n                if (obj.headers && obj.headers.length){\n                    for (var i = 0; i < obj.headers.length; i++) {\n                        request.setRequestHeader(obj.headers[i].name, obj.headers[i].value);\n                    }\n                }\n\n                obj.body?request.send(obj.body):request.send();\n\n            });\n    };\n\n    function innerArrayInHTML(elem, data){\n\n        data.sort(function(a,b){\n            console.log();\n            let surname = [a.name.split(' ')[1], b.name.split(' ')[1]];\n            if (surname[0] > surname[1]) {\n                return 1;\n            }\n            if (surname[0] < surname[1]) {\n                return -1;\n            }\n            // a должно быть равным b\n            return 0;\n        });\n\n        let fs = data[0].name.split(\" \")[1].charAt(0);\n        data.splice(0, 0, {name: fs});\n\n        for (let i = 0; i < data.length; i++) {\n            if (i<data.length-1 && fs != data[i+1].name.split(\" \")[1].charAt(0)){\n                fs = data[i+1].name.split(\" \")[1].charAt(0);\n                data.splice(i, 0, {name: fs});\n                i++;\n            }\n        }\n\n        for (let i = 0; i < document.querySelectorAll(elem).length; i++) {\n            let el = document.querySelectorAll(elem)[i];\n            el.innerHTML = tmpl(data);\n        }\n    };\n\n    function init(obj) {\n\n        if (obj.data){\n            innerArrayInHTML(obj.domElement, obj.data);\n        } else if (obj.dataRequest){\n            requestOnServer(obj.dataRequest).then(\n                function(res){\n                    innerArrayInHTML(obj.domElement, JSON.parse(res.response));\n                },\n                function(err){console.log(err)}\n            );\n        }\n    };\n\n    return {\n        init: function (obj) {\n            init(obj);\n        },\n        version: function(){\n            return version;\n        }\n    };\n\n}());\n\n"]}